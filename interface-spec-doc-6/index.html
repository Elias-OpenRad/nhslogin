<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <base href="/nhslogin">
     <link rel="stylesheet"  href="nhslogin/css/main.css">
      <link rel="stylesheet"  href="nhslogin/css/mobile-menu.css">
    <script src="nhslogin/js/main.min.js" ></script> 
<link rel="shortcut icon" href="/nhslogin/images/favicon.ico" type="image/x-icon">
<link rel="shortcut icon" href="/nhslogin/images/favicon.ico" type="image/x-icon">
<link rel="apple-touch-icon" href="/nhslogin/images/apple-touch-icon-180x180.png">
<link rel="mask-icon" href="/nhslogin/images/favicon.svg" color="#005eb8">
<link rel="icon" sizes="192x192" href="/nhslogin/images/favicon-192x192.png">

<title>6 Password-less Authentication using FIDO</title>
  </head>
  <body>
      <header class="nhsuk-header" role="banner">
        <div class="nhsuk-width-container nhsuk-header__container">
          <div class="nhsuk-header__logo">
            <a class="nhsuk-header__link nhsuk-header__link--service " href="/nhslogin" aria-label="NHS digital service manual homepage">
              <svg class="nhsuk-logo" xmlns="http://www.w3.org/2000/svg" role="presentation" focusable="false" viewBox="0 0 40 16">
                <path class="nhsuk-logo__background" d="M0 0h40v16H0z"></path>
                <path class="nhsuk-logo__text" d="M3.9 1.5h4.4l2.6 9h.1l1.8-9h3.3l-2.8 13H9l-2.7-9h-.1l-1.8 9H1.1M17.3 1.5h3.6l-1 4.9h4L25 1.5h3.5l-2.7 13h-3.5l1.1-5.6h-4.1l-1.2 5.6h-3.4M37.7 4.4c-.7-.3-1.6-.6-2.9-.6-1.4 0-2.5.2-2.5 1.3 0 1.8 5.1 1.2 5.1 5.1 0 3.6-3.3 4.5-6.4 4.5-1.3 0-2.9-.3-4-.7l.8-2.7c.7.4 2.1.7 3.2.7s2.8-.2 2.8-1.5c0-2.1-5.1-1.3-5.1-5 0-3.4 2.9-4.4 5.8-4.4 1.6 0 3.1.2 4 .6"></path>
                <image src="https://assets.nhs.uk/images/nhs-logo.png" xlink:href=""></image>
              </svg>
              <span class="nhsuk-header__service-name">
              NHS login - developer documentation
            </span>
            </a>
          </div>
          <div class="nhsuk-header__menu">
            <button class="nhsuk-header__menu-toggle" id="toggle-menu" aria-controls="header-navigation" aria-label="Open menu">Menu</button>
          </div>

          <div class="nhsuk-header__content" id="content-header"></form>
        </div>
      </div>
    </div>
  </div>
  <nav class="nhsuk-header__navigation mobile-menu" id="header-navigation" role="navigation" aria-label="Primary navigation"
  aria-labelledby="label-navigation">
  <div class="nhsuk-width-container">
    <p class="nhsuk-header__navigation-title"><span id="label-navigation">Menu</span>
      <button class="nhsuk-header__navigation-close" id="close-menu">
        <svg class="nhsuk-icon nhsuk-icon__close" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"
          aria-hidden="true" focusable="false">
          <path
            d="M13.41 12l5.3-5.29a1 1 0 1 0-1.42-1.42L12 10.59l-5.29-5.3a1 1 0 0 0-1.42 1.42l5.3 5.29-5.3 5.29a1 1 0 0 0 0 1.42 1 1 0 0 0 1.42 0l5.29-5.3 5.29 5.3a1 1 0 0 0 1.42 0 1 1 0 0 0 0-1.42z">
          </path>
        </svg>
        <span class="nhsuk-u-visually-hidden">Close menu</span>
      </button>
    </p>
    <ul class="nhsuk-header__navigation-list">
      <li>
        <h2 class="app-side-nav__heading mobile-menu__heading">
          NHS login
        </h2>
      </li>
      <li class="nhsuk-header__navigation-item nhsuk-header__navigation-item--for-mobile">
        <a class="nhsuk-header__navigation-link" href="/">
          What is NHS login
          <svg class="nhsuk-icon nhsuk-icon__chevron-right" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"
            aria-hidden="true">
            <path
              d="M15.5 12a1 1 0 0 1-.29.71l-5 5a1 1 0 0 1-1.42-1.42l4.3-4.29-4.3-4.29a1 1 0 0 1 1.42-1.42l5 5a1 1 0 0 1 .29.71z">
            </path>
          </svg>
        </a>
      </li>

      <li class="nhsuk-header__navigation-item">
        <a class="nhsuk-header__navigation-link" href="/nhslogin/oidc-login-flow">
          The OIDC login flow
          <svg class="nhsuk-icon nhsuk-icon__chevron-right" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"
            aria-hidden="true">
            <path
              d="M15.5 12a1 1 0 0 1-.29.71l-5 5a1 1 0 0 1-1.42-1.42l4.3-4.29-4.3-4.29a1 1 0 0 1 1.42-1.42l5 5a1 1 0 0 1 .29.71z">
            </path>
          </svg>
        </a>
      </li>

      <li>
        <h2 class="app-side-nav__heading mobile-menu__heading">
          Tesing NHS login
        </h2>
      </li>

      <li class="nhsuk-header__navigation-item">
        <a class="nhsuk-header__navigation-link" href="/nhslogin/test-login-service">
          Test Environments
          <svg class="nhsuk-icon nhsuk-icon__chevron-right" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"
            aria-hidden="true">
            <path
              d="M15.5 12a1 1 0 0 1-.29.71l-5 5a1 1 0 0 1-1.42-1.42l4.3-4.29-4.3-4.29a1 1 0 0 1 1.42-1.42l5 5a1 1 0 0 1 .29.71z">
            </path>
          </svg>
        </a>
      </li>
      <li class="nhsuk-header__navigation-item">
        <a class="nhsuk-header__navigation-link" href="/nhslogin/integrating-to-sandpit">
          Integrate to the sandpit
          <svg class="nhsuk-icon nhsuk-icon__chevron-right" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"
            aria-hidden="true">
            <path
              d="M15.5 12a1 1 0 0 1-.29.71l-5 5a1 1 0 0 1-1.42-1.42l4.3-4.29-4.3-4.29a1 1 0 0 1 1.42-1.42l5 5a1 1 0 0 1 .29.71z">
            </path>
          </svg>
        </a>
      </li>
      <li class="nhsuk-header__navigation-item">
        <a class="nhsuk-header__navigation-link" href="/nhslogin/generating-pem">
          Generating public key
          <svg class="nhsuk-icon nhsuk-icon__chevron-right" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"
            aria-hidden="true">
            <path
              d="M15.5 12a1 1 0 0 1-.29.71l-5 5a1 1 0 0 1-1.42-1.42l4.3-4.29-4.3-4.29a1 1 0 0 1 1.42-1.42l5 5a1 1 0 0 1 .29.71z">
            </path>
          </svg>
        </a>
      </li>

      <li>
        <h2 class="app-side-nav__heading mobile-menu__heading">
          External Interface Specification
        </h2>
      </li>

      <li class="nhsuk-header__navigation-item">
        <a class="nhsuk-header__navigation-link" href="/nhslogin/interface-spec-doc">
          Interface Specification Document
          <svg class="nhsuk-icon nhsuk-icon__chevron-right" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"
            aria-hidden="true">
            <path
              d="M15.5 12a1 1 0 0 1-.29.71l-5 5a1 1 0 0 1-1.42-1.42l4.3-4.29-4.3-4.29a1 1 0 0 1 1.42-1.42l5 5a1 1 0 0 1 .29.71z">
            </path>
          </svg>
        </a>
      </li>

      <li>
        <h2 class="app-side-nav__heading mobile-menu__heading">
          Conformance
        </h2>
      </li>

      <li class="nhsuk-header__navigation-item">
        <a class="nhsuk-header__navigation-link" href="/nhslogin/technical-conformance">
          Technical Conformance
          <svg class="nhsuk-icon nhsuk-icon__chevron-right" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"
            aria-hidden="true">
            <path
              d="M15.5 12a1 1 0 0 1-.29.71l-5 5a1 1 0 0 1-1.42-1.42l4.3-4.29-4.3-4.29a1 1 0 0 1 1.42-1.42l5 5a1 1 0 0 1 .29.71z">
            </path>
          </svg>
        </a>
      </li>

      <li>
        <h2 class="app-side-nav__heading mobile-menu__heading">
          Developer Support Information
        </h2>
      </li>

      <li class="nhsuk-header__navigation-item">
        <a class="nhsuk-header__navigation-link" href="/nhslogin/developer-support">
          Developer Support
          <svg class="nhsuk-icon nhsuk-icon__chevron-right" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"
            aria-hidden="true">
            <path
              d="M15.5 12a1 1 0 0 1-.29.71l-5 5a1 1 0 0 1-1.42-1.42l4.3-4.29-4.3-4.29a1 1 0 0 1 1.42-1.42l5 5a1 1 0 0 1 .29.71z">
            </path>
          </svg>
        </a>
      </li>

       <li>
        <h2 class="app-side-nav__heading mobile-menu__heading">
          GP Credentials
        </h2>
      </li>

       <li class="nhsuk-header__navigation-item">
        <a class="nhsuk-header__navigation-link" href="/nhslogin/gp-credentials-para">
          Using NHS login to create or retrieve GP credentials
          <svg class="nhsuk-icon nhsuk-icon__chevron-right" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"
            aria-hidden="true">
            <path
              d="M15.5 12a1 1 0 0 1-.29.71l-5 5a1 1 0 0 1-1.42-1.42l4.3-4.29-4.3-4.29a1 1 0 0 1 1.42-1.42l5 5a1 1 0 0 1 .29.71z">
            </path>
          </svg>
        </a>
      </li>

      <li class="nhsuk-header__navigation-item">
        <a class="nhsuk-header__navigation-link" href="/nhslogin/gp-credentials-doc">
          Scope and processing overview
          <svg class="nhsuk-icon nhsuk-icon__chevron-right" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"
            aria-hidden="true">
            <path
              d="M15.5 12a1 1 0 0 1-.29.71l-5 5a1 1 0 0 1-1.42-1.42l4.3-4.29-4.3-4.29a1 1 0 0 1 1.42-1.42l5 5a1 1 0 0 1 .29.71z">
            </path>
          </svg>
        </a>
      </li>

      <li>
        <h2 class="app-side-nav__heading mobile-menu__heading">
          Button Guidance
        </h2>
      </li>

      <li class="nhsuk-header__navigation-item">
        <a class="nhsuk-header__navigation-link" href="/nhslogin/adding-buttons">
          Adding the NHS login button to your service
          <svg class="nhsuk-icon nhsuk-icon__chevron-right" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"
            aria-hidden="true">
            <path
              d="M15.5 12a1 1 0 0 1-.29.71l-5 5a1 1 0 0 1-1.42-1.42l4.3-4.29-4.3-4.29a1 1 0 0 1 1.42-1.42l5 5a1 1 0 0 1 .29.71z">
            </path>
          </svg>
        </a>
      </li>

      <li>
        <h2 class="app-side-nav__heading mobile-menu__heading">
          NHS login user settings
        </h2>
      </li>

      <li class="nhsuk-header__navigation-item">
        <a class="nhsuk-header__navigation-link" href="/nhslogin/linking-to-settings-para">
          Settings information
          <svg class="nhsuk-icon nhsuk-icon__chevron-right" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"
            aria-hidden="true">
            <path
              d="M15.5 12a1 1 0 0 1-.29.71l-5 5a1 1 0 0 1-1.42-1.42l4.3-4.29-4.3-4.29a1 1 0 0 1 1.42-1.42l5 5a1 1 0 0 1 .29.71z">
            </path>
          </svg>
        </a>
      </li>


       <li>
        <h2 class="app-side-nav__heading mobile-menu__heading">
          Examples
        </h2>
      </li>

      <li class="nhsuk-header__navigation-item">
        <a class="nhsuk-header__navigation-link" href="/nhslogin/example-oidc">
          Example OIDC clients
          <svg class="nhsuk-icon nhsuk-icon__chevron-right" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"
            aria-hidden="true">
            <path
              d="M15.5 12a1 1 0 0 1-.29.71l-5 5a1 1 0 0 1-1.42-1.42l4.3-4.29-4.3-4.29a1 1 0 0 1 1.42-1.42l5 5a1 1 0 0 1 .29.71z">
            </path>
          </svg>
        </a>
      </li>
    </ul>
  </div>
</nav>
</header>

<div class="nhsuk-width-container">
  <main class="nhsuk-main-wrapper app-main-wrapper" id="maincontent">

    <div class="nhsuk-grid-row">
      <div class="nhsuk-grid-column-full app-component-reading-width">

        <div class="app-pane">

         <div class="app-pane__side-bar">

            <nav class="app-side-nav">
            
                <h2 class="app-side-nav__heading">NHS login</h2>
                <ul class="nhsuk-list app-side-nav__list">

                  <li class="app-side-nav__item">
                    <a class="app-side-nav__link" href="/nhslogin">What is NHS login?</a>
                  </li>
                  <li class="app-side-nav__item">
                    <a class="app-side-nav__link" href="nhslogin/oidc-login-flow">The OIDC login flow</a>
                  </li>
                </ul>
                <h2 class="app-side-nav__heading">Integrating with NHS login</h2>
                <ul class="nhsuk-list app-side-nav__list">

                  <li class="app-side-nav__item">
                    <a class="app-side-nav__link" href="/nhslogin/integration-process">The NHS login integration process</a>
                  </li>
                  <li class="app-side-nav__item">
                    <a class="app-side-nav__link" href="nhslogin/adding-buttons">Adding the NHS login button to your service</a>
                  </li>
                </ul>
                <h2 class="app-side-nav__heading">Testing NHS login</h2>
                <ul class="nhsuk-list app-side-nav__list">

                  <li class="app-side-nav__item">
                    <a class="app-side-nav__link" href="/nhslogin/test-login-service">Test environments</a>
                  </li>
                  <li class="app-side-nav__item">
                    <a class="app-side-nav__link" href="nhslogin/integrating-to-sandpit">Integrate to the sandpit</a>
                  </li>
                  <li class="app-side-nav__item">
                    <a class="app-side-nav__link" href="nhslogin/generating-pem">Generate public key</a>
                  </li>
                </ul>
                <h2 class="app-side-nav__heading">External Interface Specification</h2>
                <ul class="nhsuk-list app-side-nav__list">

                  <li class="app-side-nav__item">
                    <a class="app-side-nav__link" href="nhslogin/interface-spec-doc">Interface Specification Document</a>
                </ul>

                <h2 class="app-side-nav__heading">Conformance</h2>
                <ul class="nhsuk-list app-side-nav__list">

                  <li class="app-side-nav__item">
                    <a class="app-side-nav__link" href="nhslogin/technical-conformance">Technical Conformance</a>
                  </li>
                </ul>

                <h2 class="app-side-nav__heading">Developer Support Information</h2>
                <ul class="nhsuk-list app-side-nav__list">

                  <li class="app-side-nav__item">
                    <a class="app-side-nav__link" href="nhslogin/developer-support">Developer Support</a>
                  </li>
                </ul>

                <h2 class="app-side-nav__heading">GP Credentials</h2>
                <ul class="nhsuk-list app-side-nav__list">
                   <li class="app-side-nav__item">
                    <a class="app-side-nav__link" href="nhslogin/gp-credentials">Using NHS login to create or retrieve GP credentials</a>
                  </li>
                </ul>
                <h2 class="app-side-nav__heading">NHS login user settings</h2>
                <ul class="nhsuk-list app-side-nav__list">
                  <li class="app-side-nav__item">
                    <a class="app-side-nav__link" href="nhslogin/linking-to-settings">Settings information</a>
                  </li>
                </ul>
                <h2 class="app-side-nav__heading">Single Sign On</h2>
                <ul class="nhsuk-list app-side-nav__list">
                  <li class="app-side-nav__item">
                    <a class="app-side-nav__link" href="nhslogin/single-sign-on">SSO guidance</a>
                  </li>
                </ul>
                <h2 class="app-side-nav__heading">Examples</h2>
                <ul class="nhsuk-list app-side-nav__list">
                  <li class="app-side-nav__item">
                    <a class="app-side-nav__link" href="nhslogin/example-oidc">Example OIDC clients</a>
                  </li>
                </ul>
            </nav>
          </div>


          <div class="app-pane__main-content">

            <h1 class="app-page-heading">
              6 Password-less Authentication using FIDO
            </h1>

            <p>References:</p>
<ul>
<li><a href="https://fidoalliance.org/specifications/download/">FIDO Universal Authentication Framework version 1.0</a></li>
<li><a href="https://fidoalliance.org/specs/fido-uaf-v1.0-ps-20141208/fido-uaf-reg-v1.0-ps-20141208.html">FIDO UAF Registry of Predefined Values version 1.0</a></li>
<li><a href="https://fidoalliance.org/specs/fido-uaf-v1.0-ps-20141208/fido-uaf-authnr-cmds-v1.0-ps-20141208.html">FIDO UAF Authenticator Commands version 1.0</a></li>
<li><a href="https://tools.ietf.org/html/rfc6750">OAuth 2.0 Bearer Token Usage</a></li>
</ul>
<p>This section describes how the NHS Digital NHS login Platform implements password-less authentication using a combination of FIDO Universal Authentication Framework and the OpenID Connect Authorization Code Flow.</p>
<p>The NHS login Platform supports the FIDO UAF Protocol version 1.0.</p>
<hr>
<h2>6.1 Overview</h2>
<p>The objective of utilising FIDO UAF in combination with the OpenID Connect Authorization Code flow is to enable native app clients to offer an enhanced login experience to users, allowing them to utilise device-based biometric authentication (e.g. fingerprint).</p>
<p>NHS login exposes four endpoints to support password-less authentication via FIDO UAF. These are:</p>
<ol>
<li><strong>regRequest</strong> <br>Enables a client to request a FIDO UAF Registration Request Message from the NHS login platform. The access token retrieved by the client during user authentication <strong>must</strong> be presented in the Authorization HTTP Header as a Bearer token as per <a href="https://tools.ietf.org/html/rfc6750">RFC6750: OAuth 2.0 Bearer Token Usage</a>.</li>
<li><strong>regResponse</strong> <br>Enables a client to POST a FIDO UAF Registration Response Message to the NHS login platform.</li>
<li><strong>dereg</strong> <br>Enables a client to POST a FIDO UAF Deregistration Request Message to the NHS login platform specifying a set of keys to delete. The NHS login platform will remove the relevant user key(s) and return a FIDO UAF Deregistration Request Message for processing by the FIDO client. The access token retrieved by the client during user authentication <strong>must</strong> be presented in the Authorization HTTP Header as a Bearer token as per <a href="https://tools.ietf.org/html/rfc6750">RFC6750: OAuth 2.0 Bearer Token Usage</a>.</li>
<li><strong>authRequest</strong> <br>Enables a client to request a FIDO UAF Authentication Request Message from the NHS login platform. The client processes the FIDO UAF Authentication Request Message and creates a FIDO UAF Authentication Response Message which the client then base64 URL encodes and provides to the NHS login platform as an authentication request parameter (fido_auth_response) as described in <a href="https://nhsconnect.github.io/nhslogin/interface-spec-doc-3">3.4.1 Authentication request</a>.</li>
</ol>
<p>The endpoints are published in the /.well-known/openid-configuration document, under the keys  <code>fido_uaf_registration_request_endpoint</code>,  <code>fido_uaf_registration_response_endpoint</code>, <code>fido_uaf_deregistration_endpoint</code> and <code>fido_uaf_authentication_request_endpoint</code>.</p>
<hr>
<h2>6.2 FIDO UAF registration flow</h2>
<p>Figure 4 below is a non-normative illustration of the FIDO UAF Registration flow (taken from the <a href="https://fidoalliance.org/specifications/download/">FIDO UAF Architectural Overview</a>). The process is initiated after user authentication using the standard NHS login OIDC Authorization Code Flow (as per <a href="https://nhsconnect.github.io/nhslogin/interface-spec-doc-3">3.1 Authorization Code Flow</a>).</p>
<p>The client initiates registration by invoking the regRequest endpoint of the NHS login platform (1). The NHS login platform generates a FIDO UAF Registration Request Message and returns this to the client, which passes it to the FIDO Client on the device for processing (2). The FIDO Client interacts with the FIDO Authenticators on the user’s device (3) and creates a FIDO UAF Registration Response Message corresponding to the original FIDO UAF Registration Request Message. The FIDO Client passes this message back to the client which sends it to the regResponse endpoint of the NHS login service (4). The NHS login platform validates the details held within the FIDO UAF Registration Response Message and stores the relevant details (5). FIDO UAF registration is complete.</p>
<dl><dt>Figure 4 - FIDO UAF Registration flow</dt></dl>
<p><img src="nhslogin/images/EIS_Figure4.png" alt="Diagram"></p>
<h3>6.2.1 Registration Request endpoint</h3>
<p><strong>6.2.1.1	Request Syntax</strong></p>
<p>The Client sends the request for a FIDO UAF Registration Request Message using HTTP GET.</p>
<p>The Access Token obtained from an OpenID Connect Authentication Request <strong>must</strong> be sent as a Bearer Token using the Authorization header field, per <a href="https://tools.ietf.org/html/rfc6750">OAuth 2.0 Bearer Token Usage</a>, s2.</p>
<p>The following is a non-normative example of a regRequest Request:</p>
<pre class="language-html"><code class="language-html">GET /regRequest HTTP/1.1<br>Host: uaf.prod.signin.nhs.uk<br>Authorization: Bearer SlAV…32hkKG</code></pre>
<p><strong>6.2.1.2	Registration Request Validation</strong></p>
<p>The access token presented in the request is validated prior to generating a FIDO UAF Registration Response Message as per FIDO UAF Protocol Specification, s3.4.6.1.</p>
<p><strong>6.2.1.3	Registration Request Response</strong></p>
<p>The response from the Registration Request endpoint will be a FIDO UAF Registration Request Message as per FIDO UAF Protocol Specification, s3.4.1.</p>
<p>The following is a non-normative example of a response from the Registration Request endpoint:</p>
<dl><dt><i>The contents have been truncated for legibility</i></dt></dl>
<pre class="language-html"><code class="language-html">HTTP/1.1 200 OK<br>Content-Type: application/json<br>Cache-Control: no-store<br>Pragma: no-cache<br><br>[{"header": {"upv": {"major": 1,"minor": 0},<br>"op": "Reg",<br>"appID": "https://uaf-test-1.noknoktest.com:8443/SampleApp/uaf/facets",<br>"serverData": "Ijycj…VbOnvg", "exts":[{"id":"fido.uaf.uvm", "data":"", "fail_if_unknown":true}]},<br>"challenge": "H9iW9yA9aAXF_lelQoi_DhUk514Ad8Tqv0zCnCqKDpo",<br>"username": "apa",<br>"policy": {"accepted": [[{<br>"userVerification": 512,<br>"keyProtection": 1,<br>"tcDisplay": 1,<br>"authenticationAlgorithms": [1],<br>"assertionSchemes": ["UAFV1TLV"]<br>}],<br>…<br>…],<br>"disallowed": [{"userVerification": 512,<br>"keyProtection": 16,<br>"assertionSchemes": ["UAFV1TLV"]},<br>…<br>…]}}]</code></pre>
<h3>6.2.1 Registration Response endpoint</h3>
<p><strong>6.2.2.1	Request Syntax</strong></p>
<p>The Client sends the FIDO UAF Registration Response Message (as per FIDO UAF Protocol Specification, s3.4.4) to the Registration Response endpoint using HTTP POST.</p>
<p>The following is a non-normative example of a regResponse Request:</p>
<dl><dt><i>The contents have been truncated for legibility</i></dt></dl>
<pre class="language-html"><code class="language-html">POST /regResponse HTTP/1.1<br>Host: uaf.prod.signin.nhs.uk<br>Content-Type: application/json<br><br>[{"assertions": [{"assertion": "AT7uAgM…cSNmQ",<br>"assertionScheme": "UAFV1TLV"<br>}],<br>"fcParams": "eyJhcH…hcHAifQ",<br>"header": {"appID": "https://uaf-test-1.noknoktest.com:8443/SampleApp/uaf/facets",<br>"op": "Reg",<br>"serverData": "IjycjPZ…WVbOnvg",<br>"upv": {"major": 1,<br>"minor": 0}, "exts":[{"id":"fido.uaf.uvm", "data":"", "fail_if_unknown":true}]}}]</code></pre>
<p><strong>6.2.2.2	Registration Response Request Validation</strong></p>
<p>The FIDO UAF Registration Response Message is validated and processed as per FIDO UAF Protocol Specification, s3.4.6.5.</p>
<p><strong>6.2.2.3	Registration Response Response</strong></p>
<p>The response from the Registration Response endpoint will be a list of Registration records stored within the NHS login platform.</p>
<p>The following is a non-normative example of a successful response from the Registration Response endpoint:</p>
<pre class="language-html"><code class="language-html">HTTP/1.1 200 OK<br>Content-Type: application/json<br>Cache-Control: no-store<br>Pragma: no-cache<br><br>[{<br>  "attestDataToSign": "Az6…pSDg==",<br>  "attestSignature": "4PZZ…Rw==",<br>  "attestVerifiedStatus": "VALID",<br>  "authenticator": {<br>    "AAID": "107968223",<br>    "deviceId": null,<br>    "KeyID": "ODY4MjIz",<br>    "status": null,<br>    "username": "8f7…2a4"<br>  },<br>  "authenticator_string": "107968223#ODY4MjIz",<br>  "AuthenticatorVersion": "0.0",<br>  "PublicKey": "MFkw…pSDg==",<br>  "status": "SUCCESS",<br>  "timeStamp": "1547727594654",<br>  "username": "8f7…72a4"<br>}]</code></pre>
<hr>
<h2>6.3 FIDO UAF authentication flow</h2>
<p>Figure 5 below is a non-normative illustration of the FIDO UAF Authentication flow (taken from the <a href="https://fidoalliance.org/specifications/download/">FIDO UAF Architectural Overview</a>). The process is initiated after FIDO UAF registration has been completed.</p>
<p>The client initiates authentication by invoking the authRequest endpoint of the NHS login platform (1). The NHS login platform generates a FIDO UAF Authentication Request Message and returns this to the client, which passes it to the FIDO Client on the device for processing (2). The FIDO Client interacts with the FIDO Authenticators on the user’s device (3) and creates a FIDO UAF Authentication Response Message corresponding to the original FIDO UAF Registration Request Message. The FIDO Client passes this message back to the client which sends it to the NHS login service as a base64-URL encoded parameter in an OpenID Connect Authentication Request(4) (see <code>fido_auth_response</code> parameter in <a href="https://nhsconnect.github.io/nhslogin/interface-spec-doc-3">3.4.1 Authentication request</a>). The NHS login platform validates the FIDO UAF Authentication Response Message using the public key for the user stored in the NHS login FIDO registry (5) and if validated treats this as a successful authentication using an authentication vector of <code>Cm</code> (see <a href="https://nhsconnect.github.io/nhslogin/interface-spec-doc-5">5.1.2 Authentication Credentials</a>).</p>
<dl><dt>Figure 5 - FIDO UAF Authentication flow</dt></dl>
<p><img src="nhslogin/images/EIS_Figure5.png" alt="Diagram"></p>
<h3>6.3.1 Authentication Request endpoint</h3>
<p><strong>6.3.1.1	Request Syntax</strong></p>
<p>The Client sends the request for a FIDO UAF Authentication Request Message using HTTP GET.</p>
<p>The following is a non-normative example of an authRequest Request:</p>
<pre class="language-html"><code class="language-html">GET /authRequest HTTP/1.1<br>Host: uaf.prod.signin.nhs.uk</code></pre>
<p><strong>6.3.1.2	Authentication Request Validation</strong></p>
<p>No specific validation of the request is performed</p>
<p><strong>6.3.1.3	Authentication Request Response</strong></p>
<p>The response from the Authentication Request endpoint will be a FIDO UAF Authentication Request Message as per FIDO UAF Protocol Specification, s3.5.2.</p>
<p>The following is a non-normative example of a response from the Authentication Request endpoint:</p>
<dl><dt><i>The contents have been truncated for legibility</i></dt></dl>
<pre class="language-html"><code class="language-html">HTTP/1.1 200 OK<br>Content-Type: application/json<br>Cache-Control: no-store<br>Pragma: no-cache<br><br>[{"header": {"upv": {"major": 1,"minor": 0},<br>"op": "Reg",<br>"appID": "https://uaf-test-1.noknoktest.com:8443/SampleApp/uaf/facets",<br>"serverData": "Ijycj…VbOnvg", "exts":[{"id":"fido.uaf.uvm", "data":"", "fail_if_unknown":true}]},<br>"challenge": "H9iW9yA9aAXF_lelQoi_DhUk514Ad8Tqv0zCnCqKDpo",<br>"username": "apa",<br>"policy": {"accepted": [[{<br>"userVerification": 512,<br>"keyProtection": 1,<br>"tcDisplay": 1,<br>"authenticationAlgorithms": [1],<br>"assertionSchemes": ["UAFV1TLV"]<br>}],<br>…<br>…],<br>"disallowed": [{"userVerification": 512,<br>"keyProtection": 16,<br>"assertionSchemes": ["UAFV1TLV"]},<br>…<br>…]}}]</code></pre>
<hr>
<h2>6.4 FIDO UAF deregistration flow</h2>
<p>Figure 6 below is a non-normative illustration of the FIDO UAF Deregistration flow (taken from the <a href="https://fidoalliance.org/specifications/download/">FIDO UAF Architectural Overview</a>). The process can be initiated after FIDO UAF registration has been completed.</p>
<p>The client initiates authenticator deregistration by invoking the deregRequest endpoint of the NHS login platform (1). The request <strong>must</strong> include the Access Token obtained from an OpenID Connect Authentication Request, which <strong>must</strong> be sent as a Bearer Token using the Authorization header field, per <a href="https://tools.ietf.org/html/rfc6750">OAuth 2.0 Bearer Token Usage</a>, s2. The request can either be a list of authenticators to be deregistered (sent using HTTP POST) or a request to remove all authenticators for the user (using a HTTP GET). The NHS login platform generates a FIDO UAF Deregistration Request Message, removes the relevant authenticator records from the NHS login FIDO registry and returns the message to the client. The client passes the FIDO UAF Deregistration Request Message to the FIDO Client on the device for processing (3) and removal of authenticators from the device.</p>
<dl><dt>Figure 6 - FIDO UAF Deregistration flow</dt></dl>
<p><img src="nhslogin/images/EIS_Figure6.png" alt="Diagram"></p>
<h3>6.4.1	Deregistration Request endpoint</h3>
<p><strong>6.4.1.1	Request Syntax</strong></p>
<p>The Client either sends a FIDO UAF Deregistration Request Message (as per FIDO UAF Protocol Specification, s3.6.1) to the Deregistration Request endpoint using HTTP POST or can make a HTTP GET to the endpoint with no body.</p>
<p>The Access Token obtained from an OpenID Connect Authentication Request <strong>must</strong> be sent as a Bearer Token using the Authorization header field, per <a href="https://tools.ietf.org/html/rfc6750">OAuth 2.0 Bearer Token Usage</a>, s2.</p>
<p>The following is a non-normative example of a deregRequest HTTP POST Request:</p>
<dl><dt><i>The contents have been truncated for legibility</i></dt></dl>
<pre class="language-html"><code class="language-html">POST /deregRequest HTTP/1.1<br>Host: uaf.prod.signin.nhs.uk<br>Content-Type: application/json<br>Authorization: Bearer SlAV3…2hkKG<br><br>[{"header": {"appID": "https://uaf-test-1.noknoktest.com:8443/SampleApp/uaf/facets",<br>"op": "Reg",<br>"serverData": "IjycjPZ…WVbOnvg",<br>"upv": {"major": 1,<br>"minor": 0}, "exts":[{"id":"fido.uaf.uvm", "data":"", "fail_if_unknown":true}]}, "authenticators": [{"aaid": "ABCD#ABCD", "keyID": "ZMC…JfNg"}]}]</code></pre>
<p>The following is a non-normative example of a deregRequest HTTP GET Request:</p>
<pre class="language-html"><code class="language-html">GET /deregRequest HTTP/1.1<br>Host: uaf.prod.signin.nhs.uk<br>Authorization: Bearer SlAV3…2hkKG</code></pre>
<p><strong>6.4.1.2	Deregistration Request Request Validation</strong></p>
<p>The access token is validated, and the NHS login user account details are retrieved.</p>
<p>For HTTP POST processing, each authenticator provided in the message is removed from the NHS login FIDO registry once it has been validated as relating to the NHS login user account.</p>
<p>For HTTP GET processing, each authenticator stored in the NHS login FIDO registry is identified for the NHS login user account and subsequently removed.</p>
<p>The FIDO UAF Registration Response Message is validated and processed as per FIDO UAF Protocol Specification, s3.4.6.5.</p>
<p><strong>6.4.1.3	Deregistration Request Response</strong></p>
<p>The response from the Deregistration Request endpoint will be a FIDO UAF Deregistration Request Message listing the authenticator records removed from the NHS login FIDO registry.</p>
<p>The following is a non-normative example of a successful response from the Deregistration Request endpoint:</p>
<pre class="language-html"><code class="language-html">HTTP/1.1 200 OK<br>Content-Type: application/json<br>Cache-Control: no-store<br>Pragma: no-cache<br><br>[{"header": {"appID": "https://uaf-test-1.noknoktest.com:8443/SampleApp/uaf/facets",<br>"op": "Reg",<br>"serverData": "IjycjPZ…WVbOnvg",<br>"upv": {"major": 1, "minor": 0}}, <br>"authenticators": [{"aaid": "ABCD#ABCD", "keyID": "ZMC…JfNg"}]}]</code></pre>
<hr>
<h2>6.5 Platform Restrictions</h2>
<p>This section details specific restrictions implemented within the NHS login FIDO processing.</p>
<h3>6.5.1 Authenticator Policy Matching Criteria</h3>
<p>As the NHS login platform is designed for public use, restricting authenticators by device or manufacturer (i.e. via facets) is not an appropriate authenticator matching policy. Instead the platform specifies matching criteria based on User Verification Method, Authentication Algorithm, Assertion Scheme (fixed value of <code>UAFV1TLV</code>) and Key Protection.</p>
<p><strong>User Verification Methods</strong></p>
<p>The platform will accept authenticators which support Presence AND Fingerprint (1027), OR Presence AND Faceprint (1041), OR Presence AND Handprint (1281) (see <a href="https://fidoalliance.org/specs/fido-uaf-v1.0-ps-20141208/fido-uaf-reg-v1.0-ps-20141208.html">FIDO UAF Registry of Predefined Values</a>, s3.1)</p>
<p>If a FIDO UAF Registration Request Message or FIDO UAF Authentication Request Message header contains an extension with an id of <code>fido.uaf.uvm</code> then the User Verification Method utilised by the authenticator <strong>must</strong> be returned in the assertion, as a <code>TAG_EXTENSION</code> tag to the <code>TAG_UAFV1_KRD</code> tag (for Registration – see <a href="https://fidoalliance.org/specs/fido-uaf-v1.0-ps-20141208/fido-uaf-authnr-cmds-v1.0-ps-20141208.html">FIDO UAF Authenticator Commands</a>, s6.1.1.1) or <code>TAG_UAFV1_SIGNED_DATA</code> tag (for Authentication – see <a href="https://fidoalliance.org/specs/fido-uaf-v1.0-ps-20141208/fido-uaf-authnr-cmds-v1.0-ps-20141208.html">FIDO UAF Authenticator Commands</a>, s6.1.1.2). The data held in the <code>TAG_EXTENSION_ID</code> tag of the extension tag <strong>must</strong> equal <code>fido.uaf.uvm</code>, and the data held in the <code>TAG_EXTENSION_DATA</code> tag of the extension tag <strong>must</strong> contain the User Verification Method and the value <strong>must</strong> match a User Verification Method value in an accepted Matching Criteria of the relevant Request Message Policy.</p>
<p><strong>Authentication Algorithms</strong></p>
<p>The NHS login platform supports the ECDSA family of signing algorithms. Specific values supported are <code>UAF_ALG_SIGN_SECP256R1_ECDSA_SHA256_RAW</code>, <code>UAF_ALG_SIGN_SECP256R1_ECDSA_SHA256_DER</code>, <code>UAF_ALG_SIGN_SECP256K1_ECDSA_SHA256_RAW</code> or <code>UAF_ALG_SIGN_SECP256K1_ECDSA_SHA256_DER</code>.</p>
<p>See <a href="https://fidoalliance.org/specifications/download/">FIDO UAF Registry of Predefined Values</a> for specific details.</p>
<p><strong>Key Protection</strong></p>
<p>The NHS login platform supports on-device key protection mechanisms. Specific values supported are <code>KEY_PROTECTION_SOFTWARE</code>, <code>KEY_PROTECTION_HARDWARE</code>, <code>KEY_PROTECTION_TEE</code> or <code>KEY_PROTECTION_SECURE_ELEMENT</code>.</p>
<p>See <a href="https://fidoalliance.org/specifications/download/">FIDO UAF Registry of Predefined Values</a> for specific details.</p>
<h3>6.5.2	Public Key Representation Formats</h3>
<p>Clients <strong>must</strong> utilise either <code>UAF_ALG_KEY_ECC_X962_RAW</code> or <code>UAF_ALG_KEY_ECC_X962_DER</code> formats for the <code>TAG_PUB_KEY</code> to align with supported Authentication Algorithms.</p>


     <div class="app-edit-instructions">
              <hr />
              <p>Edit <a href="https://github.com/nhsconnect/nhslogin/blob/master/./src/interface-spec-doc-6.md">this page</a> on GitHub
              </p>
      </div>

            <div class="app-index-navigation app-u-hide-desktop">
              <nav class="app-side-nav">
                </ul>
              </nav>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>
</div>

<footer role="contentinfo">
  <div class="nhsuk-footer" id="nhsuk-footer">
    <div class="nhsuk-width-container">
      <h2 class="nhsuk-u-visually-hidden">Support links</h2>
      <ul class="nhsuk-footer__list">
        <li class="nhsuk-footer__list-item">
          <a class="nhsuk-footer__list-item-link" href="https://github.com/nhsconnect/nhslogin">Github</a>
        </li>
       <li class="nhsuk-footer__list-item">
          <a class "nhsuk-footer__list-item-link" href="https://nhs-login-support-slack-invite.herokuapp.com/">Slack</a>
        </li>
       <li class="nhsuk-footer__list-item">
          <a class "nhsuk-footer__list-item-link" href="mailto:engage.nhslogin@nhs.net">engage.nhslogin@nhs.net</a>
        </li>
      </ul>
      <p class="nhsuk-footer__copyright">© Crown copyright</p>
    </div>
  </div>
  <div class="app-ogl-footer">
    <div class="nhsuk-width-container"></div>
  </div>
</footer>
<script src="nhslogin/js/mobile-menu.js" ></script> 
</body>
</html>
